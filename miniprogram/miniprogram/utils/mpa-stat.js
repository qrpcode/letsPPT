"use strict";function _typeof(n){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}!function(n,o){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(void 0).Yaola=o()}(0,function(){function o(n){this.app=n}function e(n){H=t(),T=n,this.yaolaStat=new o(this)}function a(n){var o;o=n.scene!=en,en=n.scene,B=0,Q=(T=n).query.yaola_share_src,G=n.query.yaolasrc||"",I=Date.now(),U=0,on||(N=!1),on=!1,tn||(0!==O&&3e4<Date.now()-O?R=t():o&&(R=t())),0!==O&&Date.now()-O<3e4&&(F=!0),n.query.yaola_share_src&&"1044"==n.scene&&n.shareTicket?wx.getShareInfo({shareTicket:n.shareTicket,success:function(n){V=n,m("event","yaola_share_click",JSON.stringify(n))}}):n.query.yaola_share_src&&m("event","yaola_share_click",1),""===W&&wx.getSetting({withCredentials:!0,success:function(n){n.authSetting["scope.userInfo"]&&wx.getUserInfo({withCredentials:!0,success:function(n){var o=w();W=n,o.ufo=v(n),j=g(n.userInfo.avatarUrl.split("/")),y(o)}})}}),S("app","show")}function r(){O=Date.now(),""===W&&wx.getSetting({success:function(n){n.authSetting["scope.userInfo"]&&wx.getUserInfo({withCredentials:!0,success:function(n){j=g((W=n).userInfo.avatarUrl.split("/"));var o=w();o.ufo=v(n),y(o)}})}}),S("app","hide")}function s(n){z++,m("event","yaola_error_message",n)}function i(n){nn=n}function c(){X=P?this.$mp.page.route:this.route,function(n,o){var t=w();t.ev=n,t.st=Date.now(),t.life=o,t.curp=X,t.prep=Z,t.dr=Date.now()-I,t.pdr=U?Date.now()-U:0,U=Date.now(),tn&&(t.so=1),tn=!1,nn&&"{}"!=JSON.stringify(nn)&&(t.po=nn);G&&(t.qr=G,t.sr=G);Q&&(t.usr=Q);F&&(t.ps=1);$||($=!0,t.ifp=$,t.fp=X);y(t)}("page","show"),F=!1}function u(){Z=X}function f(){Z=X}function l(){m("event","yaola_pulldownrefresh",1)}function h(){m("event","yaola_reachbottom",1)}function p(n){tn=!0;var o=function(n){if(-1==n.indexOf("?"))return"";var t={};return n.split("?")[1].split("&").forEach(function(n){var o=n.split("=")[1];t[n.split("=")[0]]=o}),t}(n.path),t={};for(var e in T.query)"yaola_share_src"===e&&(t[e]=T.query[e]);var a="";if(a=-1==n.path.indexOf("?")?n.path+"?":n.path.substr(0,n.path.indexOf("?"))+"?",""!==o)for(var r in o)t[r]=o[r];for(var s in t.yaola_share_src?-1==t.yaola_share_src.indexOf(J)&&t.yaola_share_src.length<200&&(t.yaola_share_src=t.yaola_share_src+","+J):t.yaola_share_src=J,t)-1==s.indexOf("yaola")&&(a+=s+"="+t[s]+"&");return n.path=a+"yaola_share_src="+t.yaola_share_src,m("event","yaola_share_status",n),n}function d(t){var e="";if(t){e+="?";var a=Object.keys(t);a.map(function(n,o){e+=n+"="+t[n]+(o<a.length-1?"&":"")})}return e}function y(t){if(n&&"devtools"===Y.ost)return!1;B++,t.hs=R,t.rqt=Date.now(),t.uu=J,t.sdkv=L,t.ak=A.appKey.replace(/(\t)|(\s)/g,""),t.wsr=T,t.ifo=N,t.rqc=B,t.cs=H,wx.yaolaQueue.push(function(){return new Promise(function(o,n){wx.request({url:"https://"+M+"/w/d.html",data:t,header:{ys:"we-stat",se:C||"",op:E||"",img:j},method:"GET",success:function(n){o(200==n.statusCode?"":"status error")},fail:function(){n("fail")}})})})}function w(){var n={};for(var o in Y)n[o]=Y[o];return n}function g(n){for(var o="",t=0;t<n.length;t++)n[t].length>o.length&&(o=n[t]);return g}function t(){return""+Date.now()+Math.floor(1e7*Math.random())}function v(n){var o={};for(var t in n)"rawData"!=t&&"errMsg"!=t&&(o[t]=n[t]);return o}function S(n,o){var t=w();t.ev=n,t.life=o,t.ec=z,t.st=Date.now(),t.dr=Date.now()-I,"hide"===o&&(t.prep=Z,t.pdr=U?Date.now()-U:0),G&&(t.qr=G,t.sr=G),Q&&(t.usr=Q),y(t)}function m(n,o,t){var e=w();e.ev=n,e.tp=o,e.st=K,e.dr=Date.now()-I,e.pdr=U?Date.now()-U:0,t&&(e.ext=t),y(e)}function _(n,o,t){if(n[o]){var e=n[o];n[o]=function(n){t.call(this,n,o),e.call(this,n)}}else n[o]=function(n){t.call(this,n,o)}}function x(o){var n={};for(var t in o)"onLaunch"!==t&&"onShow"!==t&&"onHide"!==t&&"onError"!==t&&(n[t]=o[t]);return n.onLaunch=function(n){e.call(this,n),"function"==typeof o.onLaunch&&o.onLaunch.call(this,n)},n.onShow=function(n){a.call(this,n),o.onShow&&"function"==typeof o.onShow&&o.onShow.call(this,n)},n.onHide=function(){r.call(this),o.onHide&&"function"==typeof o.onHide&&o.onHide.call(this)},n.onError=function(n){s.call(this,n),o.onError&&"function"==typeof o.onError&&o.onError.call(this,n)},n}function D(t){var n={};for(var o in t)"onLoad"!==o&&"onShow"!==o&&"onHide"!==o&&"onUnload"!==o&&"onPullDownRefresh"!==o&&"onReachBottom"!==o&&"onShareAppMessage"!==o&&(n[o]=t[o]);return n.onLoad=function(n){i.call(this,n),"function"==typeof t.onLoad&&t.onLoad.call(this,n)},n.onShow=function(n){c.call(this),"function"==typeof t.onShow&&t.onShow.call(this,n)},n.onHide=function(n){u.call(this),"function"==typeof t.onHide&&t.onHide.call(this,n)},n.onUnload=function(n){f.call(this),"function"==typeof t.onUnload&&t.onUnload.call(this,n)},n.onReachBottom=function(n){h(),t.onReachBottom&&"function"==typeof t.onReachBottom&&t.onReachBottom.call(this,n)},n.onPullDownRefresh=function(n){l(),t.onPullDownRefresh&&"function"==typeof t.onPullDownRefresh&&t.onPullDownRefresh.call(this,n)},t.onShareAppMessage&&"function"==typeof t.onShareAppMessage&&(n.onShareAppMessage=function(n){var o=t.onShareAppMessage.call(this,n);return void 0===o?(o={}).path=this.route:void 0===o.path&&(o.path=this.route),p.call(this,o)}),n}void 0===wx.yaolaQueue&&(wx.yaolaQueue=new function(){this.concurrency=4,this.queue=[],this.tasks=[],this.activeCount=0;var e=this;this.push=function(t){this.tasks.push(new Promise(function(o){var n=function(){e.activeCount++,t().then(function(n){o(n)}).then(function(){e.next()}).catch(function(n){console.log(n)})};e.activeCount<e.concurrency?n():e.queue.push(n)}))},this.all=function(){return Promise.all(this.tasks)},this.next=function(){e.activeCount--,0<e.queue.length&&e.queue.shift()}},wx.yaolaQueue.all());var b,q,k,A=require("./mpa-stat-config"),L="1.0.4",M="mc.51.la",P=!1,R="",H="",I=0,O=0,U=0,C="",E="",j="",B=0,T="",N="",J=function(){var o="";try{o=wx.getStorageSync("yaola_stat_uuid")}catch(n){o="uuid_getstoragesync"}if(o)N=!1;else{o=function(){for(var n="",o="abcdefghijklmnopqrstuvwxyz0123456789",t=0;t<32;t++)n+=o.charAt(Math.floor(Math.random()*o.length));return n}();try{wx.setStorageSync("yaola_stat_uuid",o),N=!0}catch(n){wx.setStorageSync("yaola_stat_uuid","uuid_getstoragesync")}}return o}(),K=Date.now(),Q="",G="",z=0,V="",W="",Y={},$=!1,F=!1,X="",Z="",nn="",on=!0,tn=!1,en="",n=A.ignoreDev;wx.request({url:"https://"+M+"/w/c.json",header:{ys:"we-stat",ak:A.appKey},method:"GET",success:function(n){200===n.statusCode&&(L<n.data.version&&console.warn("您的SDK不是最新版本，请尽快升级！"),n.data.warn&&console.warn(n.data.warn),n.data.error&&console.error(n.data.error))}});try{var an=wx.getSystemInfoSync();Y.br=an.brand,Y.pm=an.model,Y.pr=an.pixelRatio,Y.ww=an.windowWidth,Y.wh=an.windowHeight,Y.lang=an.language,Y.wv=an.version,Y.ost=an.platform,Y.wsdk=an.SDKVersion,Y.os=an.system}catch(n){console.log(n)}return wx.getNetworkType({success:function(n){Y.nt=n.networkType}}),wx.getSetting({success:function(n){n.authSetting["scope.userLocation"]?wx.getLocation({type:"wgs84",success:function(n){Y.lat=n.latitude,Y.lng=n.longitude,Y.spd=n.speed}}):A.getLocation&&wx.getLocation({type:"wgs84",success:function(n){Y.lat=n.latitude,Y.lng=n.longitude,Y.spd=n.speed}})}}),o.prototype.sendEvent=function(n,o){if(""!==n&&"string"==typeof n&&n.length<=255)if("string"==typeof o&&o.length<=255)m("event",n,o);else if("object"==_typeof(o)){if(255<=JSON.stringify(o).length)return void console.error("自定义事件参数不能超过255个字符");if(function(n){for(var o in n)if("object"==_typeof(n[o])&&null!==n[o])return!0;return!1}(o))return void console.error("事件参数，参数内部只支持Number,String等类型，请参考接入文档");m("event",n,JSON.stringify(o))}else void 0===o?m("event",n,!1):console.error("事件参数必须为String,Object类型,且参数长度不能超过255个字符");else console.error("事件名称必须为String类型且不能超过255个字符")},o.prototype.sendSession=function(n){if(""!==n&&n){C=n;var o=w();o.st=Date.now(),o.tp="session",o.ext="session",o.ev="event",""===W?wx.getSetting({success:function(n){n.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(n){o.ufo=v(n),j=g(n.userInfo.avatarUrl.split("/")),""!==V&&(o.gid=V),y(o)}}):""!==V&&(o.gid=V,y(o))}}):(o.ufo=W,""!==V&&(o.gid=V),y(o))}else console.error("请传入从后台获取的session_key")},o.prototype.sendOpenid=function(n){if(""!==n&&n){E=n;var o=w();o.st=Date.now(),o.tp="openid",o.ev="event",o.ext="openid",y(o)}else console.error("openID不能为空")},n&&"devtools"===Y.ost&&console.log('您现在正处于开发模式下，51LA小程序统计不会采集上报数据，如需测试统计功能，请修改配置文件中的"ignoreDev"参数，详情可参考官方文档！'),A.plugin?{App:function(n){return App(x(n))},Page:function(n){return Page(D(n))},MpvueApp:function(n){return P=!0,x(n)},MpvuePage:function(n){return D(n)}}:(b=App,q=Page,k=Component,App=function(n){_(n,"onLaunch",e),_(n,"onShow",a),_(n,"onHide",r),_(n,"onError",s),b(n)},Page=function(n){var t=n.onShareAppMessage;_(n,"onLoad",i),_(n,"onUnload",f),_(n,"onShow",c),_(n,"onHide",u),_(n,"onReachBottom",h),_(n,"onPullDownRefresh",l),null!=t&&(n.onShareAppMessage=function(n){if(void 0!==t){var o=t.call(this,n);return void 0===o?(o={}).path=X+d(this.options):void 0===o.path&&(o.path=X+d(this.options)),p(o)}}),q(n)},void(Component=function(o){try{var t=o.methods.onShareAppMessage;_(o.methods,"onLoad",i),_(o.methods,"onUnload",f),_(o.methods,"onShow",c),_(o.methods,"onHide",u),_(o.methods,"onReachBottom",h),_(o.methods,"onPullDownRefresh",l),null!=t&&(o.methods.onShareAppMessage=function(n){if(void 0!==t){var o=t.call(this,n);return void 0===o?(o={}).path=X+d(this.options):void 0===o.path&&(o.path=X+d(this.options)),p(o)}}),k(o)}catch(n){k(o)}}))});